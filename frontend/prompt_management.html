<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt模板管理 - AI Agent</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    
    <link rel="stylesheet" href="css/pages/prompt_management.css">
</head>
<body>

    <div class="header">
        <div class="header-left">
            <div class="logo">🤖</div>
            <div class="header-title">
                <h1>AI Agent Studio</h1>
                <div class="header-title-sub">Prompt 模板管理</div>
            </div>
            <div class="header-nav">
                <div class="nav-links">
                    <a href="agent_chat.html" class="nav-link">
                        <span>💬 对话工作台</span>
                    </a>
                    <a href="prompt_management.html" class="nav-link active">
                        <span>📝 Prompt 模板</span>
                    </a>
                    <a href="knowledge_base.html" class="nav-link">
                        <span>📁 知识库</span>
                    </a>
                    <a href="memory.html" class="nav-link">
                        <span>🧠 记忆管理</span>
                    </a>
                    <a href="conversation_history.html" class="nav-link">
                        <span>📚 会话历史</span>
                    </a>
                </div>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-icon" id="themeToggle" onclick="toggleTheme()" title="切换主题">
                <span id="themeIcon">🌙</span>
            </button>
            <a href="agent_chat.html" class="btn btn-secondary">返回聊天</a>
        </div>
    </div>

    <div class="main-container">
        <!-- 左侧：智能体列表 -->
        <div class="sidebar">
            <div class="sidebar-header">智能体列表</div>
            <div class="agent-list" id="agentList">
                <div class="loading">加载中...</div>
            </div>
        </div>

        <!-- 右侧：Prompt模板列表 -->
        <div class="content-area">
            <div class="content-header">
                <h2 id="selectedAgentName">请选择一个智能体</h2>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" id="generatePromptBtn" style="display: none;" onclick="openGenerateModal()">
                        ✨ 智能生成
                    </button>
                    <button class="btn btn-primary" id="createPromptBtn" style="display: none;">
                        ➕ 创建新模板
                    </button>
                </div>
            </div>
            <div id="promptList">
                <div class="empty-state">
                    <div class="empty-state-icon">👈</div>
                    <div>请从左侧选择一个智能体查看其Prompt模板</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建/编辑模板的模态框 -->
    <div class="modal" id="promptModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">创建Prompt模板</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="promptForm">
                    <input type="hidden" id="templateId">
                    
                    <div class="form-group">
                        <label class="form-label">模板名称 *</label>
                        <input type="text" class="form-input" id="templateName" required>
                        <div class="form-hint">为这个模板起一个容易识别的名称</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">所属智能体 *</label>
                        <select class="form-select" id="templateAgentId" required>
                            <option value="">请选择智能体</option>
                        </select>
                        <div class="form-hint">选择这个模板要应用到的智能体</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">模板描述</label>
                        <input type="text" class="form-input" id="templateDescription" placeholder="可选，描述这个模板的用途">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Prompt内容 *</label>
                        <textarea class="form-textarea" id="templateContent" required placeholder="输入Prompt内容..."></textarea>
                        <div class="form-hint">可以使用 {user_query}、{task_description} 等占位符，系统会自动替换</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                <button class="btn btn-primary" onclick="savePrompt()">保存</button>
            </div>
        </div>
    </div>

    <!-- 智能生成Prompt模态框 -->
    <div class="modal" id="generateModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>✨ 智能生成Prompt</h3>
                <button class="modal-close" onclick="closeGenerateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px; padding: 16px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <p style="margin: 0; color: #1e40af; font-size: 14px;">
                        💡 <strong>提示</strong>：只需用自然语言描述你的需求，AI会自动生成专业的Prompt模板。
                    </p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">智能体</label>
                    <input type="text" class="form-input" id="generateAgentName" readonly 
                           style="background: #f3f4f6; cursor: not-allowed;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">你的需求 <span style="color: red;">*</span></label>
                    <textarea class="form-textarea" id="generateRequirement" rows="5" 
                              placeholder="例如：我需要一个能分析数据的专家，要求输出结构化JSON格式，包含关键指标和趋势分析..."></textarea>
                    <div class="form-hint">详细描述你希望这个智能体做什么，有什么特殊要求</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">参考风格（可选）</label>
                    <select class="form-select" id="generateStyle">
                        <option value="">默认</option>
                        <option value="简洁">简洁</option>
                        <option value="详细">详细</option>
                        <option value="专业">专业</option>
                        <option value="友好">友好</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">输出格式（可选）</label>
                    <select class="form-select" id="generateFormat">
                        <option value="">默认</option>
                        <option value="JSON">JSON</option>
                        <option value="Markdown">Markdown</option>
                        <option value="纯文本">纯文本</option>
                        <option value="结构化列表">结构化列表</option>
                    </select>
                </div>
                
                <div id="generateResult" style="display: none; margin-top: 20px;">
                    <!-- 验证结果提示 -->
                    <div id="validationResult" style="margin-bottom: 16px;"></div>
                    
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <strong>生成的Prompt：</strong>
                            <button class="btn btn-small btn-secondary" onclick="copyGeneratedPrompt()">📋 复制</button>
                        </div>
                        <pre id="generatedPromptContent" style="background: white; padding: 12px; border-radius: 4px; overflow-x: auto; max-height: 300px; overflow-y: auto; font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word;"></pre>
                    </div>
                    
                    <div style="margin-top: 16px; display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="saveGeneratedPrompt()">
                            💾 保存为模板
                        </button>
                        <button class="btn btn-secondary" onclick="regeneratePrompt()">
                            🔄 重新生成
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGenerateModal()">取消</button>
                <button class="btn btn-primary" onclick="generatePrompt()" id="generateBtn">
                    ✨ 生成Prompt
                </button>
            </div>
        </div>
    </div>

    
    <script src="js/pages/prompt_management.js"></script>
</body>
</html>

