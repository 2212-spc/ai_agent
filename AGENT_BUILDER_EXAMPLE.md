# Agent构建器使用示例

## 示例：智能天气助手

这个Agent会自动查询天气，如果会下雨就创建提醒笔记。

### 步骤1：打开构建器
1. 打开 `frontend/agent_chat.html`
2. 点击右上角的 **🛠️** 按钮打开Agent构建器

### 步骤2：添加节点

#### 节点1：规划器（入口节点）
- 在左侧面板点击 **🧠 规划器**
- 点击该节点，在右侧配置面板中设置提示词：
  ```
  分析用户查询，提取城市名称，制定天气查询计划。
  ```

#### 节点2：工具执行器 - 天气查询
- 在左侧面板的"可用工具"区域，点击你的天气工具（如"天气查询"）
- 点击该节点，在右侧配置面板中选择对应的工具

#### 节点3：条件判断
- 在左侧面板点击 **🔀 条件判断**
- 点击该节点，在右侧配置：
  - 条件类型：选择"包含文本"
  - 条件值：输入"雨"（检查天气结果中是否包含"雨"字）

#### 节点4：工具执行器 - 写笔记
- 在左侧面板的"可用工具"区域，点击"写入笔记文件"工具
- 点击该节点，在右侧配置面板中选择该工具

#### 节点5：合成器（结束节点）
- 在左侧面板点击 **✨ 合成器**
- 点击该节点，在右侧配置提示词：
  ```
  根据天气查询结果和是否创建了笔记，生成友好的回复给用户。
  ```

### 步骤3：连接节点

**双击连接方式：**
1. 双击 **规划器** 节点（选为源节点）
2. 双击 **天气查询** 节点（创建连接：规划器 → 天气查询）

3. 双击 **天气查询** 节点
4. 双击 **条件判断** 节点（创建连接：天气查询 → 条件判断）

5. 双击 **条件判断** 节点
6. 双击 **写笔记** 节点（创建连接：条件判断 → 写笔记）

7. 双击 **写笔记** 节点
8. 双击 **合成器** 节点（创建连接：写笔记 → 合成器）

**同时也要连接：条件判断 → 合成器**（如果不下雨，直接跳转到合成器）
- 双击 **条件判断** 节点
- 双击 **合成器** 节点

### 步骤4：保存和测试

1. 点击右上角 **保存** 按钮
2. 输入Agent名称：`智能天气助手`
3. 点击 **测试** 按钮
4. 输入测试查询：`查询北京明天的天气，如果会下雨就提醒我带伞`

### 预期效果

Agent会：
1. 🧠 规划：分析查询，提取"北京"
2. 🔧 执行：调用天气工具查询北京天气
3. 🔀 判断：检查结果中是否包含"雨"
4. 如果下雨：
   - 🔧 执行：创建提醒笔记
   - ✨ 合成：生成回复"已查询天气并创建提醒笔记"
5. 如果不下雨：
   - ✨ 合成：直接生成天气信息回复

---

## 示例2：搜索+总结Agent

### 节点流程：
1. **规划器** → 分析用户查询，确定搜索关键词
2. **工具执行器（搜索）** → 执行网络搜索
3. **LLM调用** → 使用LLM总结搜索结果
4. **合成器** → 生成最终回复

### 配置要点：
- **规划器提示词**：`提取用户查询中的关键词，准备进行网络搜索。`
- **LLM调用提示词**：`基于以下搜索结果，总结关键信息：\n{{last_tool_result}}`
- **合成器提示词**：`综合搜索和总结结果，生成详细的回答。`

---

## 常见问题

### Q: 如何删除节点？
A: 当前版本需要手动清空画布。可以刷新页面重新开始。

### Q: 如何删除连接？
A: 当前版本需要重新构建。后续版本会添加删除功能。

### Q: 工具节点配置参数在哪里？
A: 当前版本工具参数在代码中硬编码。可以：
1. 修改后端 `tool_service.py` 中的工具处理函数
2. 或者在测试时通过用户查询自动提取参数（如城市名）

### Q: 如何查看已保存的Agent？
A: 当前版本暂未实现Agent列表页面。可以通过API查看：
```bash
curl http://127.0.0.1:8000/agents
```

---

## 快速测试JSON配置

如果你想直接测试，可以使用以下JSON配置（通过API创建）：

```json
{
  "name": "智能天气助手",
  "description": "查询天气并创建提醒笔记",
  "config": {
    "nodes": [
      {
        "id": "node-1",
        "type": "planner",
        "data": {
          "label": "规划器",
          "prompt": "分析用户查询，提取城市名称，制定天气查询计划。"
        }
      },
      {
        "id": "node-2",
        "type": "tool_executor",
        "data": {
          "label": "天气查询",
          "toolId": "你的天气工具ID",
          "arguments": {}
        }
      },
      {
        "id": "node-3",
        "type": "condition",
        "data": {
          "label": "条件判断",
          "conditionType": "contains",
          "conditionValue": "雨"
        }
      },
      {
        "id": "node-4",
        "type": "tool_executor",
        "data": {
          "label": "写笔记",
          "toolId": "你的笔记工具ID",
          "arguments": {}
        }
      },
      {
        "id": "node-5",
        "type": "synthesizer",
        "data": {
          "label": "合成器",
          "prompt": "根据天气查询结果和是否创建了笔记，生成友好的回复。"
        }
      }
    ],
    "edges": [
      {"source": "node-1", "target": "node-2"},
      {"source": "node-2", "target": "node-3"},
      {"source": "node-3", "target": "node-4"},
      {"source": "node-3", "target": "node-5"},
      {"source": "node-4", "target": "node-5"}
    ]
  },
  "is_active": true
}
```

**注意**：需要替换 `toolId` 为实际的工具ID。可以通过以下API获取：
```bash
curl http://127.0.0.1:8000/tools
```

